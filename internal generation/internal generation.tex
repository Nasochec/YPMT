% !TeX encoding = windows-1251
\documentclass[fullscreen=true,russian,compress,%
hyperref={unicode,bookmarks=false}]{presentation}
\inputencoding{cp1251} % Кодировка вашего файла 
% Внимание! Опция russian не совместима с \tableofcontents
\usepackage[russian]{babel} % Эту строку можно удалить
\usepackage{paratype} % Выбираем шрифт
\usepackage{appendixnumberbeamer} 



\usepackage{fancyvrb}%для Verbatim
% Определяем длины частей нижнего колонтитула: автор, название, число слайдов
\makefootline{.35}{.55}{.1} % Сумма длин = 1

% для картинок
\usepackage{tikz} % Для создания рисунков с помощью tikz
\usetikzlibrary{shapes.multipart,calc}

\usepackage{drawstack}

\usepackage{listings} % Для листингов программ
\setbeamerfont{footline}{size=\fontsize{7}{7}\selectfont}

\graphicspath{ {./pictures/} }

\begin{document}
	
	\newtheorem{Metric}{Метрика}
	\newtheorem{weight}{Распределение весов}
	% Если потребуется, переводим названия блоков с английского:
	\deftranslation[to=Russian]{Theorem}{Теорема}
	\deftranslation[to=Russian]{Example}{Пример}
	%\deftranslation[to=Russian]{Metric}{Метрика}
	
	% Данные титульного слайда
	\title[Генерация внутренних представлений]{Генерация внутренних представлений}
	\author{Гладков Артемий Николаевич}
%	\institute{Научный руководитель: к. ф.-м. н., доцент, А.\,В.~Смирнов}
	\date{06.11.2024}
	
	% Создаем титульный слайд
	\begin{frame}
		\titlepage
	\end{frame}
	
	% \tableofcontents не работает при включенной опции russian пакета babel
	%\begin{frame}{Содержание}\tableofcontents\end{frame}
	
	\begin{frame}{Генерация внутренних представлений}

		После синтаксического анализа необходимо получить некоторое внутренне представление программы для дальнейшей трансляции в объектный код или интерпретации.
		
		Этот код универсален для всех машин, на которых происходит исполнение.
			
	\end{frame}
	
	\begin{frame}{Способы внутреннего представления программы}
		\begin{itemize}
			\item Многоадресный код с явно именуемыми результатами.
			\item Многоадресный код с неявно именуемыми результатами.
			\item Связанные списочные структуры, представляющие синтаксические деревья
			\item Префиксная запись
			\item Постфиксная запись (польская инверсная запись)\only<2->{, сокращённо \textbf{ПОЛИЗ}}
			
		\end{itemize}
		
	\end{frame}
	
	\begin{frame}{ПОЛИЗ для выражений}
		В инфиксной записи:
		$$a*(b+c)-(d-e)/f$$
		в постфиксной:
		$$abc+*de-f/-$$
		
		Порядок операндов сохранился, а для операций учтён приоритет, и исчезли скобки. 
		
		Выражения, записанные в ПОЛИЗ-е удобно вычислять с помощью стека.
		
	\end{frame}
	
	\begin{frame}
		Генерация ПОЛИЗ-а по выражению:
		\begin{itemize}
			\item Если $E$ --- операнд, то $T$ --- его ПОЛИЗ;
			\item ПОЛИЗом $E_1 \theta E_2$, где $\theta$ --- бинарная операция, а $E_1, E_2$ --- выражения, является запись $E_1' E_2' \theta$, где $E_1'$ и $E_2'$ --- ПОЛИЗ выражений $E_1$ и $E_2$;
			\item ПОЛИЗом выражения $\theta E$, где $\theta$ --- знак унарной операции, \\
			а~$E$ --- операнд, является запись $E' \theta$, где $E'$ --- ПОЛИЗ выражения $E$;
			\item  ПОЛИЗом выражения $(E)$ является ПОЛИЗ выражения $E$.
		\end{itemize}
	\end{frame}
	
	\begin{frame}{Вычисление выражения в ПОЛИЗЕ}
		Выражение прочитывается один раз слева направо и:
		\begin{itemize}
			\item если очередной элемент ПОЛИЗа --- это операнд, то его значение заносится в стек;
			\item если очередной элемент ПОЛИЗа --- это операция, то на 
			верхушке стека сейчас находятся ее операнды; 
			они извлекаются из стека, над ними выполняется операция, результат снова заносится в стек;
			\item когда выражение, записанное в ПОЛИЗе, прочитано, в стеке останется один элемент – это значение всего выражения.
		\end{itemize}
	\end{frame}
	
	\begin{frame}{Операторы языка в ПОЛИЗе}
		\textbf{Присваивание}
		$$I := E$$
		будет записано в ПОЛИЗе как
		$$\tilde{I} E :=$$
		где $:=$ --- это двухместная операция, а $\tilde{I}$ и $E$ --- операнды. $\tilde{I}$ --- означает, что операндом является адрес $I$, а не её значение.
	\end{frame}
	
	\begin{frame}{Операторы языка в ПОЛИЗе}
		\textbf{Оператор перехода} означает, что процесс интерпретации надо продолжить с того элемента ПОЛИЗа, который указан как операнд операции перехода. 
		
		\pause
		Чтобы можно было ссылаться на элементы ПОЛИЗа, будем считать, что все они перенумерованы, начиная с 1 (допустим, занесены в массив).
		
		\pause
		Пусть ПОЛИЗ оператора, помеченного меткой L, начинается с номера p, тогда оператор перехода \texttt{goto L} в ПОЛИЗе можно записать как
		$$p !$$
		где ! --- операция выбора элемента ПОЛИЗа, номер которого равен p.
	\end{frame}
	
	\begin{frame}{Операторы языка в ПОЛИЗе}
		\textbf{Условный оператор перехода} 
		
		Введем вспомогательную операцию – условный переход «по лжи» с семантикой:
		$$ if (not \: B) \: then \: goto \: L$$
		
		Это двухместная операция c операндами $B$ и $L$. Обозначим ее $!F$, тогда в ПОЛИЗе она будет записана как:
		$$B \: p \: !F$$
		
		аналогично p – номер элемента, с которого начинается ПОЛИЗ оператора, помеченного меткой L.
		
	\end{frame}

	\begin{frame}{Операторы языка в ПОЛИЗе}
		Тогда \textbf{условный оператор} 
		$$\textbf{if}\: B \: \textbf{then}\: S1\: \textbf{else}\: S2$$
		будет записан, как
		$$\textbf{if}(\textbf{not}\: B) \textbf{then}\: goto \: L2; S1; goto \: L3; \textbf{L2:}\: S2; \textbf{L3:} \hdots,$$
		а в ПОЛИЗе:
		$$B\: p2 \: !F \: S1 \: p3 \: ! \: \underset{\substack{\uparrow\\ p2}}{S2} \: \underset{\substack{\uparrow\\ p3}}{\hdots} $$
	\end{frame}
	
	\begin{frame}{Операторы языка в ПОЛИЗе}
		Тогда \textbf{оператор цикла} 
		$$\textbf{while} \: B \: \textbf{do}\: S$$
		будет записан, как
		$$\textbf{if}(\textbf{not}\: B) \textbf{then}\: goto \: L2; S1; goto \: L3; \textbf{L2:}\: S2; \textbf{L3:} \hdots,$$
		а в ПОЛИЗе:
		$$\underset{\substack{\uparrow\\ p0}}{B}\: p1 \: !F \: S \: p0 \: ! \underset{\substack{\uparrow\\ p1}}{...}$$
	\end{frame}

	\begin{frame}{Операторы языка в ПОЛИЗе}
		И, наконец, оператор ввода $\textbf{read} \: (I)$ в ПОЛИЗе будет записан как	$I \: R$;
		оператор вывода $\textbf{write} \: (E)$ – как $E \: W$.
	\end{frame}
	
	\begin{frame}{Генерация ПОЛИЗа}
		Генерацию ПОЛИЗа удобно совместить с синтаксическим анализатором.
	\end{frame}
	
	\begin{frame}{Операторы языка в ПОЛИЗе}
		Рассмотрим грамматику:
		
		$E \rightarrow T \{+ T\}$\\
		$T \rightarrow F \{* F\}$\\
		$F \rightarrow a \mid b \mid (E)$\\
		Тогда грамматика с действиями по переводу этого выражения в ПОЛИЗ будет такой:
		
		$E \rightarrow T \{+ T <put("+")>\}$\\
		$T \rightarrow F \{* F <put("*")>\}$\\
		$F \rightarrow a <put("a")> \mid b <put("b")> \mid (E)$\\
	\end{frame}
	
	
	\begin{frame}[fragile]{Результат генерации ПОЛИЗа}
	
\begin{Verbatim}[tabsize=2]
...
while a < b do begin
	{if beleberda just commentary			
	write(a);}
	a := a + 1;
	c := c * a
end	&
...	
\end{Verbatim}
		Преобразовав, получим:
%		\tilde{a} \: 0 \: := \: \tilde{b} \: 8 \: := \: \tilde{b} \: R \: \tilde{c} \: 1 \: := \:
		$$\hdots \underset{\substack{\uparrow\\ 11}}{a} \: b \: < \: 26 \: !F \: \tilde{a} \: a \: 1 \: + \: := \: \tilde{c} \: c \: a \: * \: := \: 11 \: ! \: \underset{\substack{\uparrow\\ 26}}{\hdots} $$
%		  \: c \: W \: a \: W
	\end{frame}

	\begin{frame}{Что дальше?}
		\begin{itemize}
			\item Посмотреть видео с моей реализацией Генерации внутренних представлений: <ссылка>.
			\visible<2->{\item Доработать текущее решение лабораторной работы №3. Добавить в него генерацию ПОЛИЗа.}
		\end{itemize}
	\end{frame}
	
	\begin{frame}{Будущие лекции}
		\begin{itemize}
			\item Занятие 5: первая половина пары --- исполнение кода.
			\item Занятие 6 --- приём Лабораторных. Или конец материала, если что-то не успеем.
		\end{itemize}
	\end{frame}
%	\appendix
%	
%	\begin{frame}{Распределение вероятностей в смешанных стратегиях}
%		
%	\end{frame}
	
\end{document}

